#summary Testing the conversion process on revision 3

== Stage 1. Create a test signal ==

I created a 176.4kHz 32bit wav file in Matlab with a 1kHz tone at -3dBFs. I added 1/(2^24) peak amplitude of tpdf dither (i.e. equiv to the significand precision).

The fft spectrum of 1 sec of the data is shown below. Note that this results in a 1Hz bin spacing so the 1kHz tone falls into a single bin. This was computed in Matlab from the wav file. It looks pretty good, no harmonics are visible and the dither/quantization noise is hovering at around -190dB.

[https://dsf2flac.googlecode.com/svn/wiki/testingRev3/wavTestTone.png]

== Stage 2. Convert to DSD64 (DSF) ==

The only tool I have to convert to DSD is Audiogate. This was the reason for choosing 32bit 176.4kHz wav as Audiogate cannot read anything higher.

Prior to writing dsf2pcm in cpp, I first wrote a dsf reader in Matlab before them discovering that was going to be way too slow for useful conversion. However, it has turned out to be pretty useful for analysing dsd data and designing decimation filters. I read the converted dsd data back into Matlab and computed the fft spectrum of the data (all done at 64*44.1kHz and with double precision).

The 1bit quantization noise is pretty clear and you can see that it starts rising pretty severely just above 20kHz. The noise floor below 20kHz is worse than the 32bit tone. More concerning are the three peaks that have appeared (200Hz, 3000Hz and 5000Hz). These seem to be distortion products of the 1000Hz test tone (possibly with the exception of the 200Hz tone). Why do these appear... I don't know. Is this an error in how the Audiogate conversion process works? Is this because the 1bit data is not fully dithered? Let me know if you have an idea of what is causing these.

[https://dsf2flac.googlecode.com/svn/wiki/testingRev3/dsdTestTone.png]

== Stage 3. Convert to PCM with dsf2pcm ==

I've now used dsf2pcm (revision 3) to convert back to pcm from the dsd64 dsf test file. I repeated the conversion with a few different settings just to see the difference.

=== 88200Hz 24bit 6dB gain dither on ===

command: "dsf2flac -i 1kHztone_dsd64.dsf -r88200 -b24 -s6"

I was pleasantly surprised by how well this works. Noise floor is about the same level as the dsd

[https://dsf2flac.googlecode.com/svn/wiki/testingRev3/converted88200Hz24bit.png]
